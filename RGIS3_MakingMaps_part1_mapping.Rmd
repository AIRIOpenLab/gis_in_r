---
title: "Making maps in R"
author: "Nick Eubank, building off excellent tutorials by Claudia Engel"
output:
  html_document:
    toc: true
    toc_depth: 4
    theme: spacelab
    mathjax: default
    fig_width: 6
    fig_height: 6
---


```{r knitr_init, echo=FALSE, cache=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)


library(rgdal)
library(sp)
library(plyr)

setwd("~/dropbox/gis_in_r/")
districts<-readOGR("RGIS3_Data/shapefiles",'congressional_districts')
grants<-readOGR("RGIS3_Data/shapefiles",'federal_grants')
newcrs<-CRS(proj4string(districts))
grants.newproj <- spTransform(grants, newcrs)
buffered.grants <- gBuffer(grants.newproj, width=7000, byid=FALSE)

vote_shares <- read.csv("RGIS3_Data/district_vote_shares.csv")

districts@data <- join(districts@data, vote_shares, by="DISTRICT", type="left")

```

R comes wiht a basic `plot` command, which can also be used for simple map viewing. In this workshop we will will look into two difdferent options to map spatial data in R. `sp` comes with a more refined plot command `spplot`, which takes `Spatial*~` objects. Secondly, there is `ggplot`, a more general purpose plotting library, but very powerful and one can make great maps. An additional package `ggmap` builds on `ggplot` and allows to draw in tiled basemaps from different services.

***

#. plot and spplot

Although there are other tools available for more sophisticated applications, most plotting situations can be handled through the use of two functions:

* `plot`: plot shapes associated with Spatial* or Raster objects
* `spplot`: plot shapes associated with Spatial* objects AND color them based on attributes in a associated DataFrame. 

## Plot

The syntax for each should be relatively familiar to anyone used to working with `plot` in other settings -- just pass the sp object to plot! Here's an example using the `districts` object from the RGIS2 tutorial:

```{r}
plot(districts)
```

It's also easy to add some basic options using standard `plot` modifiers:

```{r}
plot(districts, col="red")
title(main="California Electoral Districts", sub="House of Representatives")
```

When plotting points, you can also use lots of the basic `plot` options for points. [You can find a table of symbol-to-number mappings here](http://www.statmethods.net/advgraphs/parameters.html)
```{r}
plot(grants.newproj, pch=22, col="red", bg="blue")
```

### Multiple layers with `plot`

It's also easy to plot multiple layers using `plot` with the `add` option:

```{r}
plot(districts)
plot(buffered.grants, col="blue", add=T)
```


## spplot
`spplot` is an extension of `plot` specifically for making maps of Spatial* objects. In particular, it's very useful for filling in polygon colors based on attributes in an associated DataFrame (what are called "chloropleth" maps). Just pass an Spatial*DataFrame object and the name of columns you want to plot (if you don't pass specific column names, a separate figure will be created for each column.)

```{r}
spplot(districts, "dem_vote_share", main="California Electoral Districts", sub="Democratic Vote Shares")
```

[A big list of example graphs with associated code can be found here](http://rspatial.r-forge.r-project.org/gallery/)

### Custom colors for `spplot`

### Multiple layers with `spplot`

# Dot-Density Plots

